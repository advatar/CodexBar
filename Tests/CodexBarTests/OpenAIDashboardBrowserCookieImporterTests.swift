import Testing
@testable import CodexBarCore

@Suite
struct OpenAIDashboardBrowserCookieImporterTests {
    @Test
    func mismatchErrorMentionsSourceLabel() {
        let err = OpenAIDashboardBrowserCookieImporter.ImportError.noMatchingAccount(
            found: [
                .init(sourceLabel: "Safari", email: "a@example.com"),
                .init(sourceLabel: "Chrome", email: "b@example.com"),
            ])
        let msg = err.localizedDescription
        #expect(msg.contains("Safari=a@example.com"))
        #expect(msg.contains("Chrome=b@example.com"))
    }

    #if os(macOS)
    @Test
    func limitsToSingleKeychainBrowserPerPass() {
        let limited = OpenAIDashboardBrowserCookieImporter.limitToSingleKeychainBrowserPerPass([
            .safari,
            .chrome,
            .edge,
            .firefox,
            .arc,
        ])
        #expect(limited == [.safari, .chrome, .firefox])
    }
    #endif
}
